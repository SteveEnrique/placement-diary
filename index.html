<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RKMVC Placement Diary</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        rkm: {
                            maroon: '#800000',
                            maroonLight: '#A01515',
                            gold: '#FFC107',
                            goldLight: '#FFD54F',
                            cream: '#FEFCE8',
                        }
                    },
                    fontFamily: {
                        serif: ['"Noto Serif"', 'serif'],
                        sans: ['"Noto Sans"', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.8s ease-out',
                        'slide-up': 'slideUp 0.6s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    
    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Icons & Fonts -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700&family=Noto+Serif:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        /* Applied Cream Background Globally */
        body { font-family: 'Noto Sans', sans-serif; background-color: #FEFCE8; }
        h1, h2, h3, .brand-font { font-family: 'Noto Serif', serif; }
        
        /* Premium Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #FEFCE8; }
        ::-webkit-scrollbar-thumb { background: #800000; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .glass-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        @media print {
            body { background: white; -webkit-print-color-adjust: exact; }
            .no-print { display: none !important; }
            .print-break-inside-avoid { break-inside: avoid; }
            .shadow-md, .shadow-lg, .shadow-xl { box-shadow: none !important; }
            .border-t-4 { border-top-width: 2px !important; }
            .glass-nav { background: white !important; backdrop-filter: none !important; }
        }
    </style>
</head>
<body class="text-slate-900 antialiased selection:bg-rkm-gold selection:text-rkm-maroon bg-rkm-cream">

    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // --- CONFIGURATION ---
        const HARDCODED_CONFIG = {
            apiKey: "AIzaSyAIIlLfjh265a8cDtUmDaukEst2s12GqvME",
            authDomain: "rkmvc-placement-2025-2026.firebaseapp.com",
            projectId: "rkmvc-placement-2025-2026",
            storageBucket: "rkmvc-placement-2025-2026.firebasestorage.app",
            messagingSenderId: "886169557208",
            appId: "1:886169557208:web:2e69a76784a587a9e79fac",
            measurementId: "G-3V10HBH51Y"
        };

        const APP_COLLECTION_ID = "rkmvc-placement-diary-live-v2";
        const DEFAULT_LOGO = "https://upload.wikimedia.org/wikipedia/en/7/76/Ramakrishna_Mission_Emblem.svg";
        
        // --- QUOTES ---
        const QUOTES = [
            "Arise, awake, and stop not till the goal is reached.",
            "All power is within you; you can do anything and everything.",
            "Take up one idea. Make that one idea your life.",
            "Education is the manifestation of the perfection already in man.",
            "Strength is Life, Weakness is Death.",
            "Believe in yourself and the world will be at your feet.",
            "The greatest sin is to think yourself weak."
        ];

        // --- ICONS ---
        const Icon = ({ name, size = 20, className = "" }) => {
            React.useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={className} style={{ width: size, height: size, display: 'inline-block', verticalAlign: 'middle' }}></i>;
        };

        // --- NAVBAR ---
        const Navbar = ({ isEditMode, setEditMode }) => {
            const [logo, setLogo] = React.useState(localStorage.getItem('custom_logo') || DEFAULT_LOGO);
            
            const changeLogo = () => {
                const newLogo = prompt("Enter new Logo URL:", logo);
                if(newLogo) {
                    setLogo(newLogo);
                    localStorage.setItem('custom_logo', newLogo);
                }
            };

            return (
                <nav className="sticky top-0 z-50 glass-nav border-b border-slate-200 no-print transition-all duration-300">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex justify-between items-center h-20">
                            <div className="flex items-center space-x-4 group cursor-default">
                                <div className="relative">
                                    <img src={logo} alt="RKM Emblem" className="h-14 w-auto drop-shadow-md transform group-hover:scale-105 transition-transform duration-500" onError={(e) => e.target.src = DEFAULT_LOGO} />
                                    {isEditMode && (
                                        <button onClick={changeLogo} className="absolute -bottom-2 -right-2 bg-slate-800 text-white p-1 rounded-full text-[10px] opacity-0 group-hover:opacity-100 transition-opacity" title="Change Logo">
                                            <Icon name="edit-2" size={10} />
                                        </button>
                                    )}
                                </div>
                                <div className="flex flex-col">
                                    <h1 className="text-rkm-maroon font-bold text-sm md:text-lg leading-none font-serif tracking-wide uppercase">Ramakrishna Mission</h1>
                                    <h2 className="text-slate-800 font-bold text-base md:text-2xl leading-tight font-serif tracking-wider uppercase">Vivekananda College</h2>
                                    <p className="text-[10px] md:text-xs text-rkm-gold font-bold tracking-[0.2em] uppercase hidden md:block">Autonomous • Mylapore</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <button onClick={() => window.print()} className="flex items-center space-x-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-full shadow-sm text-xs md:text-sm font-bold uppercase tracking-wider transition-all">
                                    <Icon name="printer" size={16} /> <span className="hidden md:inline">Print</span>
                                </button>
                                <button 
                                    onClick={() => setEditMode(!isEditMode)}
                                    className={`p-2 rounded-full transition-all duration-300 shadow-sm border ${isEditMode ? 'bg-rkm-gold text-rkm-maroon border-rkm-maroon rotate-0' : 'bg-white text-slate-400 border-slate-200 -rotate-12 hover:rotate-0'}`}
                                    title={isEditMode ? "Exit Admin Mode" : "Enter Admin Mode"}
                                >
                                    <Icon name={isEditMode ? "unlock" : "lock"} size={18} />
                                </button>
                            </div>
                        </div>
                    </div>
                    <div className="h-1 w-full bg-gradient-to-r from-rkm-maroon via-rkm-gold to-rkm-maroon"></div>
                </nav>
            );
        };

        // --- QUOTE BANNER ---
        const QuoteBanner = () => {
            const [index, setIndex] = React.useState(0);
            const [fade, setFade] = React.useState(true);

            React.useEffect(() => {
                const interval = setInterval(() => {
                    setFade(false);
                    setTimeout(() => {
                        setIndex((prev) => (prev + 1) % QUOTES.length);
                        setFade(true);
                    }, 500);
                }, 3500);
                return () => clearInterval(interval);
            }, []);

            return (
                <div className="bg-rkm-cream border-b border-slate-100 py-3 text-center no-print relative overflow-hidden">
                    <div className="max-w-4xl mx-auto px-4">
                        <p className={`text-rkm-maroon font-serif italic text-sm md:text-lg transition-opacity duration-500 ${fade ? 'opacity-100' : 'opacity-0'}`}>
                            "{QUOTES[index]}"
                        </p>
                        <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">- Swami Vivekananda</p>
                    </div>
                </div>
            );
        };

        // --- HERO ---
        const Hero = ({ stats }) => {
            const getNum = (v) => { const n = parseInt(String(v).replace(/\D/g,'')); return isNaN(n)?0:n; };
            const totalPlaced = stats.reduce((acc, curr) => acc + getNum(curr.selected), 0);
            const totalCompanies = new Set(stats.map(s => s.company)).size;

            return (
                <React.Fragment>
                    <div className="hidden print:block w-full border-b-4 border-double border-rkm-maroon mb-8 pb-4">
                        <div className="flex items-center justify-between">
                            <img src={DEFAULT_LOGO} alt="Emblem" className="h-24 w-auto" />
                            <div className="text-center flex-1 px-4">
                                <h1 className="text-2xl font-bold uppercase font-serif text-rkm-maroon">Ramakrishna Mission Vivekananda College</h1>
                                <p className="text-sm font-semibold uppercase">(Autonomous)</p>
                                <p className="text-sm text-slate-500 mt-1">Mylapore, Chennai - 600004</p>
                                <div className="mt-4 inline-block border-t-2 border-rkm-gold pt-2 px-8"><h2 className="text-xl font-bold uppercase">Placement Diary</h2><p className="text-sm font-bold text-slate-500">2025-2026</p></div>
                            </div>
                        </div>
                    </div>

                    <div className="relative bg-gradient-to-br from-rkm-maroon to-red-900 text-white overflow-hidden no-print shadow-lg animate-fade-in" style={{ minHeight: '340px' }}>
                        <div className="absolute top-0 left-0 w-full h-full opacity-10">
                            <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="dots" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse"><circle cx="2" cy="2" r="1" fill="#FFC107"/></pattern></defs><rect width="100%" height="100%" fill="url(#dots)" /></svg>
                        </div>
                        
                        <div className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-20 flex flex-col justify-center h-full">
                            <div className="border-l-4 border-rkm-gold pl-6 animate-slide-up" style={{animationDelay: '0.1s'}}>
                                <span className="text-rkm-gold font-bold tracking-widest uppercase text-xs md:text-sm mb-2 block">Career Guidance Bureau</span>
                                <h1 className="text-4xl md:text-6xl font-serif font-bold leading-tight mb-4 drop-shadow-md">
                                    Placement Diary <br/>
                                    <span className="text-rkm-gold">2025 - 2026</span>
                                </h1>
                                <p className="text-sm md:text-lg text-slate-200 max-w-2xl font-light leading-relaxed">
                                    Bridging the gap between education and employment. Documenting the journey of our students towards success.
                                </p>
                            </div>

                            <div className="grid grid-cols-2 gap-4 max-w-lg mt-10 animate-slide-up" style={{animationDelay: '0.3s'}}>
                                <div className="bg-white/10 backdrop-blur-md rounded-lg p-4 border border-white/20 hover:bg-white/20 transition-colors">
                                    <div className="text-3xl font-bold text-white">{totalPlaced}</div>
                                    <div className="text-[10px] text-rkm-gold uppercase tracking-widest font-bold mt-1">Offers Received</div>
                                </div>
                                <div className="bg-white/10 backdrop-blur-md rounded-lg p-4 border border-white/20 hover:bg-white/20 transition-colors">
                                    <div className="text-3xl font-bold text-white">{totalCompanies}</div>
                                    <div className="text-[10px] text-rkm-gold uppercase tracking-widest font-bold mt-1">Companies Visited</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </React.Fragment>
            );
        };

        // --- STATS TABLE ---
        const StatsTable = ({ data, isEditMode, onDelete, onAdd }) => {
            const [sortConfig, setSortConfig] = React.useState({ key: 'date', direction: 'desc' });
            const sortedData = [...data].sort((a, b) => {
                if (a[sortConfig.key] < b[sortConfig.key]) return sortConfig.direction === 'asc' ? -1 : 1;
                if (a[sortConfig.key] > b[sortConfig.key]) return sortConfig.direction === 'asc' ? 1 : -1;
                return 0;
            });

            return (
                <section className="py-12 bg-rkm-cream print:py-4 relative z-10 -mt-8 rounded-t-3xl mx-2 md:mx-0 shadow-xl md:shadow-none md:rounded-none md:mt-0 border-t md:border-t-0 border-slate-100">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 print:mb-4 border-b border-slate-200 pb-4 gap-4">
                            <div>
                                <h2 className="text-2xl md:text-3xl font-bold text-slate-800 font-serif flex items-center">
                                    <span className="bg-rkm-maroon/10 p-2 rounded-lg mr-3 text-rkm-maroon"><Icon name="bar-chart-3" size={24} /></span>
                                    Placement Statistics
                                </h2>
                            </div>
                            {isEditMode && (
                                <button onClick={onAdd} className="w-full md:w-auto flex items-center justify-center space-x-2 bg-slate-900 hover:bg-slate-800 text-white px-5 py-2.5 rounded-full shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all no-print text-sm font-bold uppercase tracking-wider">
                                    <Icon name="plus" size={16} /> <span>Add Record</span>
                                </button>
                            )}
                        </div>

                        {data.length === 0 ? (
                            <div className="text-center py-16 bg-white/50 rounded-2xl border-2 border-dashed border-slate-300">
                                <div className="text-slate-400 mb-3"><Icon name="clipboard-list" size={48} /></div>
                                <p className="text-slate-600 font-medium">No placement records yet.</p>
                                {isEditMode && <p className="text-sm text-rkm-maroon mt-2 font-bold cursor-pointer hover:underline" onClick={onAdd}>+ Add your first record</p>}
                            </div>
                        ) : (
                            <div className="overflow-x-auto border border-slate-200 rounded-xl shadow-sm bg-white print:border-2 print:border-black print:rounded-none">
                                <table className="min-w-full divide-y divide-slate-100 text-sm whitespace-nowrap">
                                    <thead className="bg-slate-50 text-slate-600 font-bold uppercase tracking-wider text-xs print:bg-slate-200 print:text-black">
                                        <tr>
                                            {['Date', 'Company', 'Mode', 'Apt', 'GD', 'Tech', 'HR', 'Selected'].map((head) => (
                                                <th key={head} className="px-6 py-4 text-left print:border-r print:border-slate-300">{head}</th>
                                            ))}
                                            {isEditMode && <th className="px-6 py-4 no-print"></th>}
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {sortedData.map((row) => (
                                            <tr key={row.id} className="hover:bg-slate-50 transition-colors print:border-b print:border-slate-300">
                                                <td className="px-6 py-4 font-mono text-slate-500 text-xs print:border-r">{new Date(row.date).toLocaleDateString('en-GB')}</td>
                                                <td className="px-6 py-4 font-bold text-slate-800 print:border-r">{row.company}</td>
                                                <td className="px-6 py-4 text-slate-500 print:border-r">
                                                    <span className={`px-2 py-1 rounded-full text-xs font-bold border ${row.mode.toLowerCase().includes('virtual') ? 'bg-purple-50 text-purple-700 border-purple-100' : 'bg-blue-50 text-blue-700 border-blue-100'} print:border-0 print:p-0`}>{row.mode}</span>
                                                </td>
                                                <td className="px-6 py-4 text-center text-slate-600 print:border-r">{row.aptitude || '-'}</td>
                                                <td className="px-6 py-4 text-center text-slate-600 print:border-r">{row.gd || '-'}</td>
                                                <td className="px-6 py-4 text-center text-slate-600 print:border-r">{row.tech || '-'}</td>
                                                <td className="px-6 py-4 text-center text-slate-600 print:border-r">{row.hr || '-'}</td>
                                                <td className="px-6 py-4 text-center print:border-0"><span className="inline-flex items-center justify-center px-3 py-1 rounded-full bg-green-100 text-green-700 font-bold text-xs print:bg-transparent print:text-black">{row.selected}</span></td>
                                                {isEditMode && <td className="px-6 py-4 text-right no-print"><button onClick={() => onDelete(row.id, 'placement_stats')} className="text-slate-300 hover:text-red-500 transition-colors"><Icon name="trash-2" size={16} /></button></td>}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>
                </section>
            );
        };

        // --- DIARY SECTION ---
        const DiarySection = ({ data, isEditMode, onDelete, onAdd }) => {
            const sortedData = [...data].sort((a, b) => new Date(b.date) - new Date(a.date));

            return (
                <section className="py-16 bg-rkm-cream print:bg-white print:py-4 border-t border-slate-200">
                    <div className="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-end mb-12 print:mb-4 border-b border-slate-200 pb-4 gap-4">
                            <div>
                                <h2 className="text-2xl md:text-3xl font-bold text-slate-800 font-serif flex items-center">
                                    <span className="bg-rkm-gold/20 p-2 rounded-lg mr-3 text-rkm-maroon"><Icon name="book-open" size={24} /></span>
                                    Activities Log
                                </h2>
                                <p className="text-slate-500 text-sm mt-1 ml-14">Chronological timeline of events and workshops.</p>
                            </div>
                            {isEditMode && (
                                <button onClick={onAdd} className="w-full md:w-auto flex items-center justify-center space-x-2 bg-slate-900 hover:bg-slate-800 text-white px-5 py-2.5 rounded-full shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all no-print text-sm font-bold uppercase tracking-wider">
                                    <Icon name="plus" size={16} /> <span>Add Event</span>
                                </button>
                            )}
                        </div>

                        {data.length === 0 ? (
                            <div className="text-center py-16 bg-white rounded-2xl border-2 border-dashed border-slate-200">
                                <div className="text-slate-300 mb-3"><Icon name="calendar-off" size={48} /></div>
                                <p className="text-slate-500 font-medium">No events logged yet.</p>
                                {isEditMode && <p className="text-sm text-rkm-maroon mt-2 font-bold cursor-pointer hover:underline" onClick={onAdd}>+ Add your first event</p>}
                            </div>
                        ) : (
                            <div className="space-y-8 print:space-y-6 relative before:absolute before:inset-0 before:ml-5 before:-translate-x-px md:before:mx-auto md:before:translate-x-0 before:h-full before:w-0.5 before:bg-gradient-to-b before:from-transparent before:via-slate-300 before:to-transparent print:before:hidden">
                                {sortedData.map((item, idx) => (
                                    <div key={item.id} className="relative flex items-center justify-between md:justify-normal md:odd:flex-row-reverse group is-active animate-slide-up" style={{animationDelay: idx * 0.1 + 's'}}>
                                        <div className="flex items-center justify-center w-10 h-10 rounded-full border-4 border-white bg-rkm-gold text-white shadow shrink-0 md:order-1 md:group-odd:-translate-x-1/2 md:group-even:translate-x-1/2 print:hidden"><Icon name="calendar" size={16} /></div>
                                        
                                        <div className="w-[calc(100%-4rem)] md:w-[calc(50%-2.5rem)] bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition-shadow border border-slate-100 print:w-full print:shadow-none print:border-slate-400 print:break-inside-avoid">
                                            <div className="flex justify-between items-start mb-3">
                                                <div className="space-y-1">
                                                    <span className="inline-block px-3 py-1 text-[10px] font-bold uppercase tracking-wide text-rkm-maroon bg-red-50 rounded-full mb-2 border border-red-100">{new Date(item.date).toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })}</span>
                                                    <h3 className="text-xl font-bold text-slate-800 font-serif leading-tight">{item.title}</h3>
                                                    {item.location && <div className="text-xs font-medium text-slate-500 flex items-center"><Icon name="map-pin" size={12} className="mr-1"/> {item.location}</div>}
                                                </div>
                                                {isEditMode && <button onClick={() => onDelete(item.id, 'placement_diary')} className="text-slate-300 hover:text-red-600 no-print transition-colors"><Icon name="trash-2" size={18} /></button>}
                                            </div>
                                            <p className="text-slate-600 text-sm leading-relaxed whitespace-pre-wrap mb-4 font-serif">{item.desc}</p>
                                            {item.tags && <div className="flex flex-wrap gap-2 mb-4 no-print">{item.tags.map((tag, i) => (<span key={i} className="text-[10px] font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded uppercase tracking-wider">#{tag}</span>))}</div>}
                                            
                                            {item.images && item.images.length > 0 && (
                                                <div className="grid grid-cols-1 gap-2 mt-4 pt-4 border-t border-slate-100">
                                                    {item.images.map((img, idx) => (
                                                        <div key={idx} className="relative rounded-lg overflow-hidden bg-slate-50 border border-slate-100">
                                                            <img src={img} className="w-full h-auto max-h-80 object-contain mx-auto" onError={(e) => {e.target.onerror=null; e.target.src="https://placehold.co/600x400?text=Invalid+Link";}} />
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </section>
            );
        };

        const Footer = () => (
            <footer className="bg-slate-900 text-slate-400 py-12 no-print border-t-4 border-rkm-gold">
                <div className="max-w-7xl mx-auto px-4 text-center space-y-4">
                    <div>
                        <h3 className="font-serif text-xl font-bold text-white uppercase tracking-widest">Ramakrishna Mission Vivekananda College</h3>
                        <p className="text-xs font-bold text-rkm-gold uppercase tracking-wider mt-1">Autonomous • Re-accredited 'A+' by NAAC</p>
                    </div>
                    <div className="text-xs border-t border-slate-800 pt-8 mt-8 max-w-xs mx-auto">
                        © 2025 Career Guidance Bureau.<br/>Designed for Excellence.
                    </div>
                </div>
            </footer>
        );

        // --- FORMS ---
        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4 no-print animate-fade-in">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh] animate-slide-up">
                        <div className="px-6 py-5 bg-slate-50 border-b border-slate-100 flex justify-between items-center">
                            <h3 className="font-bold text-lg text-slate-800 font-serif">{title}</h3>
                            <button onClick={onClose} className="p-2 bg-white rounded-full text-slate-400 hover:text-red-600 hover:bg-red-50 transition-colors shadow-sm"><Icon name="x" size={18} /></button>
                        </div>
                        <div className="p-6 overflow-y-auto">{children}</div>
                    </div>
                </div>
            );
        };

        const AddStatForm = ({ onClose, db }) => {
            const [formData, setFormData] = React.useState({ date: "", company: "", mode: "Physical", aptitude: "", gd: "", tech: "", hr: "", selected: "" });
            const handleSubmit = async (e) => {
                e.preventDefault();
                if(!db) return alert("Database not connected");
                try { await addDoc(collection(db, 'artifacts', APP_COLLECTION_ID, 'public', 'data', 'placement_stats'), { ...formData, createdAt: serverTimestamp() }); onClose(); } catch(e) { alert("Error: " + e.message); }
            };
            return (
                <form onSubmit={handleSubmit} className="space-y-4">
                    <div className="grid grid-cols-2 gap-3">
                        <div><label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Date</label><input type="date" required className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={e => setFormData({...formData, date: e.target.value})} /></div>
                        <div><label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Mode</label><select className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={e => setFormData({...formData, mode: e.target.value})}><option>Physical</option><option>Virtual</option><option>Mixed</option></select></div>
                    </div>
                    <div><label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Company Name</label><input required className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={e => setFormData({...formData, company: e.target.value})} /></div>
                    <div className="grid grid-cols-4 gap-2">
                        {['aptitude', 'gd', 'tech', 'hr'].map(k => (<div key={k}><label className="text-[10px] font-bold text-slate-400 uppercase mb-1 block text-center">{k}</label><input className="w-full p-2 bg-slate-50 border border-slate-200 rounded text-center text-sm outline-none" onChange={e => setFormData({...formData, [k]: e.target.value})} /></div>))}
                    </div>
                    <div><label className="text-xs font-bold text-green-700 uppercase mb-1 block">Selected Candidates</label><input className="w-full p-3 bg-green-50 border border-green-200 rounded-lg text-green-800 font-bold outline-none" onChange={e => setFormData({...formData, selected: e.target.value})} /></div>
                    <button type="submit" className="w-full bg-slate-900 text-white p-4 rounded-xl uppercase font-bold text-sm tracking-widest hover:bg-rkm-maroon transition-colors shadow-lg mt-2">Save Record</button>
                </form>
            );
        };

        const AddDiaryForm = ({ onClose, db }) => {
            const [formData, setFormData] = React.useState({ date: "", title: "", desc: "", location: "", image1: "", tags: "" });
            const handleSubmit = async (e) => {
                e.preventDefault();
                if(!db) return alert("Database not connected");
                const images = formData.image1 ? [formData.image1] : [];
                const tags = formData.tags.split(',').map(t => t.trim()).filter(t => t);
                try { await addDoc(collection(db, 'artifacts', APP_COLLECTION_ID, 'public', 'data', 'placement_diary'), { ...formData, images, tags, createdAt: serverTimestamp() }); onClose(); } catch(e) { alert("Error: " + e.message); }
            };
            return (
                <form onSubmit={handleSubmit} className="space-y-4">
                    <div className="grid grid-cols-2 gap-3">
                        <div><label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Date</label><input type="date" required className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={e => setFormData({...formData, date: e.target.value})} /></div>
                        <div><label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Location</label><input className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={e => setFormData({...formData, location: e.target.value})} /></div>
                    </div>
                    <input required placeholder="Event Title" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={e => setFormData({...formData, title: e.target.value})} />
                    <textarea required placeholder="Description" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg h-24 outline-none" onChange={e => setFormData({...formData, desc: e.target.value})}></textarea>
                    <input placeholder="Image URL (https://...)" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={e => setFormData({...formData, image1: e.target.value})} />
                    <button type="submit" className="w-full bg-slate-900 text-white p-4 rounded-xl uppercase font-bold text-sm tracking-widest hover:bg-rkm-maroon transition-colors shadow-lg mt-2">Save Event</button>
                </form>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [db, setDb] = React.useState(null);
            const [statsData, setStatsData] = React.useState([]);
            const [diaryData, setDiaryData] = React.useState([]);
            const [isEditMode, setIsEditMode] = React.useState(false);
            const [showStatModal, setShowStatModal] = React.useState(false);
            const [showDiaryModal, setShowDiaryModal] = React.useState(false);

            // Initialize with Hardcoded Config + NO AUTH
            React.useEffect(() => {
                try {
                    const app = initializeApp(HARDCODED_CONFIG);
                    const database = getFirestore(app);
                    setDb(database);
                } catch(e) { console.error(e); }
            }, []);

            // Fetch Data
            React.useEffect(() => {
                if (!db) return;
                const statsQ = collection(db, 'artifacts', APP_COLLECTION_ID, 'public', 'data', 'placement_stats');
                const diaryQ = collection(db, 'artifacts', APP_COLLECTION_ID, 'public', 'data', 'placement_diary');

                const unsubStats = onSnapshot(statsQ, s => setStatsData(s.docs.map(d => ({ id: d.id, ...d.data() }))));
                const unsubDiary = onSnapshot(diaryQ, s => setDiaryData(s.docs.map(d => ({ id: d.id, ...d.data() }))));
                return () => { unsubStats(); unsubDiary(); };
            }, [db]);

            const handleDelete = async (id, collectionName) => {
                if (!db) return;
                if (confirm("Delete this record permanently?")) {
                    await deleteDoc(doc(db, 'artifacts', APP_COLLECTION_ID, 'public', 'data', collectionName, id));
                }
            };

            return (
                <div className="min-h-screen flex flex-col">
                    <Navbar isEditMode={isEditMode} setEditMode={setIsEditMode} />
                    <QuoteBanner />
                    <Hero stats={statsData} />
                    <main className="relative z-10 flex-grow">
                        <StatsTable data={statsData} isEditMode={isEditMode} onDelete={handleDelete} onAdd={() => setShowStatModal(true)} />
                        <DiarySection data={diaryData} isEditMode={isEditMode} onDelete={handleDelete} onAdd={() => setShowDiaryModal(true)} />
                    </main>
                    <Footer />
                    <Modal isOpen={showStatModal} onClose={() => setShowStatModal(false)} title="Add Statistic"><AddStatForm onClose={() => setShowStatModal(false)} db={db} /></Modal>
                    <Modal isOpen={showDiaryModal} onClose={() => setShowDiaryModal(false)} title="Add Diary Event"><AddDiaryForm onClose={() => setShowDiaryModal(false)} db={db} /></Modal>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
