<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RKMVC Placement Diary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { rkm: { maroon: '#800000', gold: '#FFC107', cream: '#FFFDD0' } },
                    fontFamily: { serif: ['"Noto Serif"', 'serif'], sans: ['"Noto Sans"', 'sans-serif'] }
                }
            }
        }
    </script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700&family=Noto+Serif:ital,wght@0,700;1,400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans', sans-serif; }
        h1, h2, h3, .brand-font { font-family: 'Noto Serif', serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @media print {
            body { background: white; }
            .no-print { display: none !important; }
            .print-break-inside-avoid { break-inside: avoid; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

        // ✅ CONFIGURATION (From your chat message)
        const HARDCODED_CONFIG = {
            apiKey: "AIzaSyAIILFjh265a8dDtUmDaukEst2s12GqvME",
            authDomain: "rkmvc-placement-2025-2026.firebaseapp.com",
            projectId: "rkmvc-placement-2025-2026",
            storageBucket: "rkmvc-placement-2025-2026.firebasestorage.app",
            messagingSenderId: "886169557208",
            appId: "1:886169557208:web:2e69a76704a587a9e79fad",
            measurementId: "G-3V10HBHF1Y"
        };
        
        const APP_COLLECTION_ID = "rkmvc-placement-diary-live-v2";
        const LOGO_URL = "https://upload.wikimedia.org/wikipedia/en/thumb/7/76/Ramakrishna_Mission_Emblem.svg/1200px-Ramakrishna_Mission_Emblem.svg.png"; 

        // --- HELPERS ---
        const safeParseInt = (val) => { const num = parseInt(String(val).replace(/\D/g, '')); return isNaN(num) ? 0 : num; };
        const Icon = ({ name, size = 20, className = "" }) => { React.useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]); return <i data-lucide={name} className={className} style={{ width: size, height: size, display: 'inline-block', verticalAlign: 'middle' }}></i>; };

        // --- COMPONENTS ---

        const Navbar = ({ activeTab, setActiveTab, isEditMode, setEditMode }) => (
            <nav className="sticky top-0 z-50 bg-white shadow-md border-b-4 border-rkm-gold no-print">
                <div className="max-w-7xl mx-auto px-4">
                    <div className="flex flex-col md:flex-row justify-between items-center h-auto md:h-20 py-2 md:py-0 gap-4">
                        <div className="text-center md:text-left mb-2 md:mb-0">
                            <h1 className="text-rkm-maroon font-bold text-lg md:text-xl uppercase tracking-wide leading-none">Ramakrishna Mission</h1>
                            <h2 className="text-rkm-gold font-bold text-xl md:text-2xl uppercase leading-none" style={{textShadow: '1px 1px 0 #800000'}}>Vivekananda College</h2>
                        </div>
                        <div className="flex items-center gap-4">
                            <div className="flex bg-slate-100 p-1 rounded-lg overflow-x-auto max-w-[280px] md:max-w-none">
                                {['stats', 'activities', 'officials', 'team'].map(tab => (
                                    <button key={tab} onClick={() => setActiveTab(tab)} className={`px-3 py-2 rounded-md text-xs md:text-sm font-bold transition-all uppercase whitespace-nowrap ${activeTab === tab ? 'bg-rkm-maroon text-white shadow' : 'text-slate-500 hover:text-slate-700'}`}>{tab}</button>
                                ))}
                            </div>
                            <button onClick={() => window.print()} className="text-slate-500 hover:text-rkm-maroon" title="Print"><Icon name="printer" size={20} /></button>
                            <button onClick={() => setEditMode(!isEditMode)} className={`text-slate-500 hover:text-rkm-maroon ${isEditMode ? 'text-red-600' : ''}`} title="Admin Mode"><Icon name={isEditMode ? "unlock" : "lock"} size={20} /></button>
                        </div>
                    </div>
                </div>
            </nav>
        );

        const StatsView = ({ data, isEditMode, onDelete, onAdd }) => {
            const totalPlaced = data.reduce((acc, curr) => acc + safeParseInt(curr.selected), 0);
            const totalCompanies = new Set(data.map(s => s.company)).size;
            return (
                <div>
                    <div className="bg-rkm-maroon text-white py-12 md:py-16 text-center relative shadow-inner">
                        <div className="relative z-10 container mx-auto px-4">
                            <h2 className="text-3xl md:text-5xl font-bold font-serif mb-2">Placement Overview</h2>
                            <div className="flex justify-center gap-6 md:gap-12 mt-8">
                                <div className="bg-white/10 backdrop-blur-md rounded-xl p-4 w-40 border-t-4 border-rkm-gold">
                                    <div className="text-4xl font-bold text-white">{totalPlaced}</div>
                                    <div className="text-xs text-rkm-gold uppercase font-bold tracking-widest">Offers</div>
                                </div>
                                <div className="bg-white/10 backdrop-blur-md rounded-xl p-4 w-40 border-t-4 border-rkm-gold">
                                    <div className="text-4xl font-bold text-white">{totalCompanies}</div>
                                    <div className="text-xs text-rkm-gold uppercase font-bold tracking-widest">Recruiters</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div className="max-w-7xl mx-auto px-4 -mt-6 relative z-20 pb-20">
                        <div className="bg-white rounded-lg shadow-xl border border-slate-200 overflow-hidden">
                            <div className="p-4 border-b flex justify-between items-center bg-slate-50">
                                <h3 className="font-bold text-slate-700 flex items-center gap-2"><Icon name="table" size={18}/> Detailed Statistics</h3>
                                {isEditMode && <button onClick={onAdd} className="bg-rkm-maroon text-white px-3 py-1 rounded text-xs font-bold uppercase tracking-wider">+ Add</button>}
                            </div>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm text-left whitespace-nowrap">
                                    <thead className="bg-slate-100 text-slate-600 border-b"><tr>{['Date', 'Company', 'Mode', 'Apt', 'GD', 'Tech', 'HR', 'Selected'].map(h => <th key={h} className="px-6 py-4 font-bold uppercase text-xs">{h}</th>)}{isEditMode && <th></th>}</tr></thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {data.map((row) => (
                                            <tr key={row.id} className="hover:bg-amber-50 transition-colors">
                                                <td className="px-6 py-4 font-mono text-slate-500">{new Date(row.date).toLocaleDateString('en-GB')}</td>
                                                <td className="px-6 py-4 font-bold text-rkm-maroon">{row.company}</td>
                                                <td className="px-6 py-4"><span className="px-2 py-0.5 rounded bg-slate-100 border text-xs">{row.mode}</span></td>
                                                <td className="px-6 py-4 text-center text-slate-500">{row.aptitude}</td><td className="px-6 py-4 text-center text-slate-500">{row.gd}</td><td className="px-6 py-4 text-center text-slate-500">{row.tech}</td><td className="px-6 py-4 text-center text-slate-500">{row.hr}</td>
                                                <td className="px-6 py-4 text-center"><span className="bg-green-100 text-green-800 px-3 py-1 rounded-full font-bold text-xs">{row.selected}</span></td>
                                                {isEditMode && <td className="px-6 py-4 text-right"><button onClick={() => onDelete(row.id, 'placement_stats')} className="text-slate-300 hover:text-red-600"><Icon name="trash-2" size={16}/></button></td>}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const ActivitiesView = ({ data, isEditMode, onDelete, onAdd }) => {
            const [filter, setFilter] = React.useState('All');
            const filteredData = filter === 'All' ? data : data.filter(item => (item.category || 'Recruitment Drive') === filter);
            return (
                <div className="min-h-screen pb-20">
                    <div className="bg-white border-b border-slate-200 pt-8 pb-4 mb-8 text-center shadow-sm">
                        <h2 className="text-3xl font-serif font-bold text-slate-800 mb-2">Activities Log</h2>
                        <div className="flex flex-wrap justify-center gap-2 px-4 mt-4">
                            {['All', 'Recruitment Drive', 'Student Empowerment', 'Event'].map(cat => (
                                <button key={cat} onClick={() => setFilter(cat)} className={`px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide border ${filter === cat ? 'bg-slate-800 text-white' : 'bg-white text-slate-500'}`}>{cat}</button>
                            ))}
                        </div>
                        {isEditMode && <button onClick={onAdd} className="mt-4 text-rkm-maroon border border-rkm-maroon px-4 py-1 rounded hover:bg-rkm-maroon hover:text-white text-xs font-bold uppercase">+ Add Activity</button>}
                    </div>
                    <div className="max-w-3xl mx-auto px-4 space-y-8">
                        {filteredData.map((item) => (
                            <article key={item.id} className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden border-l-4 border-l-rkm-gold">
                                {item.image && (<div className="w-full h-48 md:h-64 overflow-hidden bg-slate-100 relative"><img src={item.image} className="w-full h-full object-cover" onError={(e)=>e.target.style.display='none'} /></div>)}
                                <div className="p-6">
                                    <div className="flex items-center justify-between mb-2">
                                        <div className="flex items-center gap-2 text-[10px] font-bold uppercase text-slate-400"><span>{new Date(item.date).toLocaleDateString('en-GB')}</span><span className="px-2 py-0.5 rounded bg-slate-100 border">{item.category || 'General'}</span></div>
                                        {isEditMode && <button onClick={() => onDelete(item.id, 'placement_diary')} className="text-slate-300 hover:text-red-600"><Icon name="trash-2" size={16}/></button>}
                                    </div>
                                    <h3 className="text-xl font-serif font-bold text-rkm-maroon mb-2">{item.title}</h3>
                                    <div className="prose prose-slate max-w-none text-sm text-slate-700 whitespace-pre-wrap">{item.desc}</div>
                                </div>
                            </article>
                        ))}
                    </div>
                </div>
            );
        };

        const PeopleView = ({ data, title, isEditMode, onDelete, onAdd, type }) => (
            <div className="min-h-screen pb-20">
                <div className="bg-white border-b py-12 text-center mb-8">
                    <h2 className="text-3xl font-serif font-bold text-rkm-maroon mb-2">{title}</h2>
                    {isEditMode && <button onClick={onAdd} className="mt-4 bg-rkm-gold text-rkm-maroon px-4 py-1 rounded font-bold text-xs uppercase">+ Add Member</button>}
                </div>
                <div className="max-w-5xl mx-auto px-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {data.map(p => (
                            <div key={p.id} className="bg-white p-6 rounded-xl shadow-sm border-t-4 border-rkm-maroon text-center relative group">
                                {isEditMode && <button onClick={() => onDelete(p.id, type)} className="absolute top-2 right-2 text-slate-300 hover:text-red-600"><Icon name="trash-2" size={16}/></button>}
                                <div className="mx-auto bg-slate-100 rounded-full mb-4 w-20 h-20 overflow-hidden border-2 border-rkm-gold flex items-center justify-center">
                                    {p.image ? <img src={p.image} className="w-full h-full object-cover" /> : <Icon name="user" size={32} className="text-slate-300"/>}
                                </div>
                                <h3 className="font-bold text-lg text-slate-800">{p.name}</h3>
                                <p className="text-rkm-maroon font-serif text-xs font-bold">{p.role}</p>
                                {p.dept && <span className="bg-slate-100 text-slate-500 text-[10px] px-2 py-0.5 rounded uppercase mt-2 inline-block">{p.dept}</span>}
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        );

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (<div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/60 p-4 backdrop-blur-sm"><div className="bg-white rounded-lg shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]"><div className="px-6 py-4 border-b flex justify-between items-center"><h3 className="font-bold text-lg">{title}</h3><button onClick={onClose}><Icon name="x" size={20}/></button></div><div className="p-6 overflow-y-auto">{children}</div></div></div>);
        };

        const AddStatForm = ({ onClose, db }) => {
            const [f, setF] = React.useState({});
            const sub = async (e) => { e.preventDefault(); await addDoc(collection(db, 'artifacts', APP_COLLECTION_ID, 'public', 'data', 'placement_stats'), { ...f, createdAt: serverTimestamp() }); onClose(); };
            return (<form onSubmit={sub} className="space-y-4"><div className="grid grid-cols-2 gap-2"><input type="date" required className="border p-2 w-full rounded" onChange={e=>setF({...f,date:e.target.value})} /><select className="border p-2 w-full rounded" onChange={e=>setF({...f,mode:e.target.value})}><option>Physical</option><option>Virtual</option></select></div><input placeholder="Company" required className="border p-2 w-full rounded" onChange={e=>setF({...f,company:e.target.value})} /><div className="grid grid-cols-4 gap-2"><input placeholder="Apt" className="border p-2 rounded text-center" onChange={e=>setF({...f,aptitude:e.target.value})} /><input placeholder="GD" className="border p-2 rounded text-center" onChange={e=>setF({...f,gd:e.target.value})} /><input placeholder="Tech" className="border p-2 rounded text-center" onChange={e=>setF({...f,tech:e.target.value})} /><input placeholder="HR" className="border p-2 rounded text-center" onChange={e=>setF({...f,hr:e.target.value})} /></div><input placeholder="Selected" className="border p-2 w-full rounded bg-green-50" onChange={e=>setF({...f,selected:e.target.value})} /><button className="w-full bg-rkm-maroon text-white p-2 rounded font-bold">Save</button></form>);
        };

        const AddDiaryForm = ({ onClose, db }) => {
            const [f, setF] = React.useState({ category: "Recruitment Drive" });
            const sub = async (e) => { e.preventDefault(); await addDoc(collection(db, 'artifacts', APP_COLLECTION_ID, 'public', 'data', 'placement_diary'), { ...f, createdAt: serverTimestamp() }); onClose(); };
            return (<form onSubmit={sub} className="space-y-4"><div className="grid grid-cols-2 gap-2"><input type="date" required className="border p-2 w-full rounded" onChange={e=>setF({...f,date:e.target.value})} /><select className="border p-2 w-full rounded" onChange={e=>setF({...f,category:e.target.value})}><option>Recruitment Drive</option><option>Student Empowerment</option><option>Event</option></select></div><input placeholder="Title" required className="border p-2 w-full rounded" onChange={e=>setF({...f,title:e.target.value})} /><textarea placeholder="Description" required className="border p-2 w-full rounded h-24" onChange={e=>setF({...f,desc:e.target.value})}></textarea><input placeholder="Location" className="border p-2 w-full rounded" onChange={e=>setF({...f,location:e.target.value})} /><input placeholder="Image URL" className="border p-2 w-full rounded" onChange={e=>setF({...f,image:e.target.value})} /><button className="w-full bg-rkm-maroon text-white p-2 rounded font-bold">Publish</button></form>);
        };

        const AddPersonForm = ({ onClose, db, type }) => {
            const [f, setF] = React.useState({});
            const sub = async (e) => { e.preventDefault(); await addDoc(collection(db, 'artifacts', APP_COLLECTION_ID, 'public', 'data', type), { ...f, createdAt: serverTimestamp() }); onClose(); };
            return (<form onSubmit={sub} className="space-y-4"><input placeholder="Name" required className="border p-2 w-full rounded" onChange={e=>setF({...f,name:e.target.value})} /><input placeholder="Role" required className="border p-2 w-full rounded" onChange={e=>setF({...f,role:e.target.value})} /><input placeholder="Dept" className="border p-2 w-full rounded" onChange={e=>setF({...f,dept:e.target.value})} /><input placeholder="Photo URL" className="border p-2 w-full rounded" onChange={e=>setF({...f,image:e.target.value})} /><button className="w-full bg-rkm-maroon text-white p-2 rounded font-bold">Add</button></form>);
        };

        const App = () => {
            const [user, setUser] = React.useState(null);
            const [db, setDb] = React.useState(null);
            const [data, setData] = React.useState({ stats: [], diary: [], officials: [], team: [] });
            const [activeTab, setActiveTab] = React.useState('stats');
            const [isEdit, setIsEdit] = React.useState(false);
            const [modal, setModal] = React.useState(null);
            const [debugMsg, setDebugMsg] = React.useState("Initializing...");

            React.useEffect(() => {
                try {
                    const app = initializeApp(HARDCODED_CONFIG);
                    const auth = getAuth(app);
                    const database = getFirestore(app);
                    setDb(database);
                    signInAnonymously(auth)
                        .then(() => setDebugMsg("Connected"))
                        .catch(e => setDebugMsg("Auth Failed: " + e.message));
                    onAuthStateChanged(auth, setUser);
                } catch(e) { setDebugMsg("Init Error: " + e.message); }
            }, []);

            React.useEffect(() => {
                if (!user || !db) return;
                // Simplified Data Fetching - No Sort on Server
                const fetchData = (col, key) => {
                    onSnapshot(query(collection(db, 'artifacts', APP_COLLECTION_ID, 'public', 'data', col)), s => {
                        const list = s.docs.map(d => ({id: d.id, ...d.data()}));
                        if (key === 'stats' || key === 'diary') list.sort((a,b) => new Date(b.date||0) - new Date(a.date||0));
                        setData(prev => ({ ...prev, [key]: list }));
                    }, err => setDebugMsg("Data Error: " + err.message));
                };
                fetchData('placement_stats', 'stats');
                fetchData('placement_diary', 'diary');
                fetchData('placement_officials', 'officials');
                fetchData('placement_team', 'team');
            }, [user, db]);

            const deleteRec = async (id, type) => {
                if (confirm("Delete permanently?")) await deleteDoc(doc(db, 'artifacts', APP_COLLECTION_ID, 'public', 'data', type, id));
            };

            return (
                <div className="min-h-screen flex flex-col">
                    <Navbar activeTab={activeTab} setActiveTab={setActiveTab} isEditMode={isEdit} setEditMode={setIsEdit} />
                    <main className="flex-grow">
                        {activeTab === 'stats' && <StatsView data={data.stats} isEditMode={isEdit} onDelete={deleteRec} onAdd={() => setModal('stat')} />}
                        {activeTab === 'activities' && <ActivitiesView data={data.diary} isEditMode={isEdit} onDelete={deleteRec} onAdd={() => setModal('diary')} />}
                        {activeTab === 'officials' && <PeopleView data={data.officials} title="Placement Officials" subtitle="Honouring our pillars" isEditMode={isEdit} onDelete={deleteRec} onAdd={() => setModal('official')} type="placement_officials" />}
                        {activeTab === 'team' && <PeopleView data={data.team} title="Student Coordinators" subtitle="The driving force" isEditMode={isEdit} onDelete={deleteRec} onAdd={() => setModal('team')} type="placement_team" />}
                    </main>
                    <footer className="bg-slate-900 text-white py-6 text-center no-print mt-auto text-[10px] flex flex-col items-center">
                        <p>© 2025 RKMVC</p>
                        <p className="text-slate-600 mt-1">Status: {debugMsg}</p>
                    </footer>
                    <Modal isOpen={!!modal} onClose={() => setModal(null)} title={modal}>
                        {modal === 'stat' && <AddStatForm onClose={() => setModal(null)} db={db} />}
                        {modal === 'diary' && <AddDiaryForm onClose={() => setModal(null)} db={db} />}
                        {(modal === 'official' || modal === 'team') && <AddPersonForm onClose={() => setModal(null)} db={db} type={modal === 'official' ? 'placement_officials' : 'placement_team'} />}
                    </Modal>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
